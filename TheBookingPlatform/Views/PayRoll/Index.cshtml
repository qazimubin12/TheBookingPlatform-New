@model TheBookingPlatform.ViewModels.PayRollViewModel
@{
    ViewBag.Title = "Index";
}
<script src="~/Content/MainTemplate/assets/js/jquery.select-bootstrap.js"></script>
<style>
    .panel-heading > .dropdown .dropdown-toggle {
        color: inherit
    }

    .btn-group-justified > .btn-group .dropdown-menu {
        left: auto
    }

    .btn-group > .btn-group:first-child:not(:last-child) > .btn:last-child, .btn-group > .btn-group:first-child:not(:last-child) > .dropdown-toggle {
        border-top-right-radius: 0;
        border-bottom-right-radius: 0
    }

    .btn-group > .btn-group:last-child:not(:first-child) > .btn:first-child {
        border-top-left-radius: 0;
        border-bottom-left-radius: 0
    }

    .dropdown-menu-hide {
        display: none !important; /* Initially hidden */
    }

    .dropdown-menu-show {
        display: block !important; /* Show dropdown when class is added */
    }


    .btn-group .dropdown-toggle:active, .btn-group.open .dropdown-toggle {
        outline: 0
    }

    .btn-group > .btn + .dropdown-toggle {
        padding-right: 8px;
        padding-left: 8px
    }

    .btn-group > .btn-lg + .dropdown-toggle {
        padding-right: 12px;
        padding-left: 12px
    }

    .btn-group.open .dropdown-toggle {
        -webkit-box-shadow: inset 0 3px 5px rgba(0,0,0,.125);
        box-shadow: inset 0 3px 5px rgba(0,0,0,.125)
    }

        .btn-group.open .dropdown-toggle.btn-link {
            -webkit-box-shadow: none;
            box-shadow: none
        }

    .btn-group > .btn:not(:first-child):not(:last-child):not(.dropdown-toggle) {
        border-radius: 0
    }

    .btn-group > .btn:first-child {
        margin-left: 0
    }

        .btn-group > .btn:first-child:not(:last-child):not(.dropdown-toggle) {
            border-top-right-radius: 0;
            border-bottom-right-radius: 0
        }

    .btn-group > .btn:last-child:not(:first-child), .btn-group > .dropdown-toggle:not(:first-child) {
        border-top-left-radius: 0;
        border-bottom-left-radius: 0
    }

    .btn-group > .btn-group {
        float: left
    }

    .dropdown, .dropup {
        position: relative
    }

    .dropdown-toggle:focus {
        outline: 0
    }

    .dropdown-menu {
        position: absolute;
        top: 100%;
        left: 0;
        z-index: 1000;
        display: none;
        float: left;
        min-width: 160px;
        padding: 5px 0;
        margin: 2px 0 0;
        font-size: 14px;
        text-align: left;
        list-style: none;
        background-color: #fff;
        -webkit-background-clip: padding-box;
        background-clip: padding-box;
        border: 1px solid #ccc;
        border: 1px solid rgba(0,0,0,.15);
        border-radius: 4px;
        -webkit-box-shadow: 0 6px 12px rgba(0,0,0,.175);
        box-shadow: 0 6px 12px rgba(0,0,0,.175)
    }

        .dropdown-menu.pull-right {
            right: 0;
            left: auto
        }

        .dropdown-menu .divider {
            height: 1px;
            margin: 9px 0;
            overflow: hidden;
            background-color: #e5e5e5
        }

        .dropdown-menu > li > a {
            display: block;
            padding: 3px 20px;
            clear: both;
            font-weight: 400;
            line-height: 1.42857143;
            color: #333;
            white-space: nowrap
        }

            .dropdown-menu > li > a:focus, .dropdown-menu > li > a:hover {
                color: #262626;
                text-decoration: none;
                background-color: #f5f5f5
            }

        .dropdown-menu > .active > a, .dropdown-menu > .active > a:focus, .dropdown-menu > .active > a:hover {
            color: #fff;
            text-decoration: none;
            background-color: #337ab7;
            outline: 0
        }

        .dropdown-menu > .disabled > a, .dropdown-menu > .disabled > a:focus, .dropdown-menu > .disabled > a:hover {
            color: #777
        }

            .dropdown-menu > .disabled > a:focus, .dropdown-menu > .disabled > a:hover {
                text-decoration: none;
                cursor: not-allowed;
                background-color: transparent;
                background-image: none;
                filter: progid:DXImageTransform.Microsoft.gradient(enabled=false)
            }

    .open > .dropdown-menu {
        display: block
    }

    .open > a {
        outline: 0
    }

    .dropdown-menu-right {
        right: 0;
        left: auto
    }

    .dropdown-menu-left {
        right: auto;
        left: 0
    }

    .dropdown-header {
        display: block;
        padding: 3px 20px;
        font-size: 12px;
        line-height: 1.42857143;
        color: #777;
        white-space: nowrap
    }

    .dropdown-backdrop {
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        z-index: 990
    }

    .pull-right > .dropdown-menu {
        right: 0;
        left: auto
    }

    .dropdown-menu > li > a {
        padding: 8px 20px !important;
    }

    .dropup .caret, .navbar-fixed-bottom .dropdown .caret {
        content: "";
        border-top: 0;
        border-bottom: 4px dashed;
        border-bottom: 4px solid\9
    }

    .dropup .dropdown-menu, .navbar-fixed-bottom .dropdown .dropdown-menu {
        top: auto;
        bottom: 100%;
        margin-bottom: 2px
    }

    @@media (min-width:768px) {
        .navbar-right .dropdown-menu {
            right: 0;
            left: auto
        }

        .navbar-right .dropdown-menu-left {
            right: auto;
            left: 0
        }
    }

    select.bs-select-hidden, select.selectpicker {
        display: none !important;
    }

    .bootstrap-select {
        width: 220px \0;
        /*IE9 and below*/
    }

        .bootstrap-select > .dropdown-toggle {
            width: 100%;
            padding-right: 25px;
            z-index: 1;
        }

        .bootstrap-select > select {
            position: absolute !important;
            bottom: 0;
            left: 50%;
            display: block !important;
            width: 0.5px !important;
            height: 100% !important;
            padding: 0 !important;
            opacity: 0 !important;
            border: none;
        }

            .bootstrap-select > select.mobile-device {
                top: 0;
                left: 0;
                display: block !important;
                width: 100% !important;
                z-index: 2;
            }

    .has-error .bootstrap-select .dropdown-toggle, .error .bootstrap-select .dropdown-toggle {
        border-color: #b94a48;
    }

    .bootstrap-select.fit-width {
        width: auto !important;
    }

    .bootstrap-select:not([class*="col-"]):not([class*="form-control"]):not(.input-group-btn) {
        width: 100%;
    }

    .bootstrap-select.form-control {
        margin-bottom: 0;
        padding: 0;
        border: none;
    }

        .bootstrap-select.form-control:not([class*="col-"]) {
            width: 100%;
        }

        .bootstrap-select.form-control.input-group-btn {
            z-index: auto;
        }

            .bootstrap-select.form-control.input-group-btn:not(:first-child):not(:last-child) > .btn {
                border-radius: 0;
            }

    .bootstrap-select.btn-group:not(.input-group-btn), .bootstrap-select.btn-group[class*="col-"] {
        float: none;
        display: inline-block;
        margin-left: 0;
    }

        .bootstrap-select.btn-group.dropdown-menu-right, .bootstrap-select.btn-group[class*="col-"].dropdown-menu-right, .row .bootstrap-select.btn-group[class*="col-"].dropdown-menu-right {
            float: right;
        }

    .form-inline .bootstrap-select.btn-group, .form-horizontal .bootstrap-select.btn-group, .form-group .bootstrap-select.btn-group {
        margin-bottom: 0;
    }

    .form-group-lg .bootstrap-select.btn-group.form-control, .form-group-sm .bootstrap-select.btn-group.form-control {
        padding: 0;
    }

    .form-inline .bootstrap-select.btn-group .form-control {
        width: 100%;
    }

    .bootstrap-select.btn-group .dropdown-menu li.disabled a:hover, .bootstrap-select.btn-group .dropdown-menu li.disabled a:focus {
        box-shadow: none;
    }

    .bootstrap-select.btn-group.disabled, .bootstrap-select.btn-group > .disabled {
        cursor: not-allowed;
    }

        .bootstrap-select.btn-group.disabled:focus, .bootstrap-select.btn-group > .disabled:focus {
            outline: none !important;
        }

    .bootstrap-select.btn-group.bs-container {
        position: absolute;
        height: 0 !important;
        padding: 0 !important;
    }

        .bootstrap-select.btn-group.bs-container .dropdown-menu {
            z-index: 1060;
        }

    .bootstrap-select.btn-group .dropdown-toggle .filter-option {
        display: inline-block;
        overflow: hidden;
        width: 100%;
        text-align: left;
        text-overflow: ellipsis;
    }

    .bootstrap-select.btn-group .dropdown-toggle .caret {
        position: absolute;
        top: 50%;
        right: 16px;
        margin-top: -2px;
        vertical-align: middle;
    }

    .bootstrap-select.btn-group[class*="col-"] .dropdown-toggle {
        width: 100%;
    }

    .bootstrap-select.btn-group .dropdown-menu {
        border-radius: 4px;
        padding: 0;
        min-width: 100%;
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        box-sizing: border-box;
    }

        .bootstrap-select.btn-group .dropdown-menu.inner {
            position: static;
            float: none;
            border: 0;
            padding: 5px 0;
            margin: 0;
            -webkit-box-shadow: none;
            box-shadow: none;
            -ms-overflow-style: auto;
        }

        .bootstrap-select.btn-group .dropdown-menu li {
            position: relative;
        }

            .bootstrap-select.btn-group .dropdown-menu li.active small {
                color: #fff;
            }

            .bootstrap-select.btn-group .dropdown-menu li.disabled a {
                cursor: not-allowed;
            }

            .bootstrap-select.btn-group .dropdown-menu li a {
                cursor: pointer;
                -webkit-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
                outline: 0;
            }

                .bootstrap-select.btn-group .dropdown-menu li a:focus, .bootstrap-select.btn-group .dropdown-menu li a:hover {
                    box-shadow: 0 4px 20px 0px rgba(0, 0, 0, 0.14), 0 7px 10px -5px rgba(156, 39, 176, 0.4);
                    background-color: seagreen;
                    color: white;
                }

                .bootstrap-select.btn-group .dropdown-menu li a.opt {
                    position: relative;
                    padding-left: 2.25em;
                }

                .bootstrap-select.btn-group .dropdown-menu li a span.check-mark {
                    display: none;
                }

                .bootstrap-select.btn-group .dropdown-menu li a span.text {
                    display: inline-block;
                }

            .bootstrap-select.btn-group .dropdown-menu li small {
                padding-left: 0.5em;
            }

        .bootstrap-select.btn-group .dropdown-menu .notify {
            position: absolute;
            bottom: 5px;
            width: 96%;
            margin: 0 2%;
            min-height: 26px;
            padding: 3px 5px;
            background: #f5f5f5;
            border: 1px solid #e3e3e3;
            -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.05);
            box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.05);
            pointer-events: none;
            opacity: 0.9;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
        }

    .bootstrap-select.btn-group .no-results {
        padding: 3px;
        background: #f5f5f5;
        margin: 0 5px;
        white-space: nowrap;
    }

    .bootstrap-select.btn-group.fit-width .dropdown-toggle .filter-option {
        position: static;
    }

    .bootstrap-select.btn-group.fit-width .dropdown-toggle .caret {
        position: static;
        top: auto;
        margin-top: -1px;
    }

    .bootstrap-select.btn-group.show-tick .dropdown-menu li.selected a span.check-mark {
        position: absolute;
        display: inline-block;
        right: 15px;
        font-size: 16px;
    }

    .bootstrap-select.btn-group.show-tick .dropdown-menu li a span.text {
        margin-right: 34px;
    }

    .bootstrap-select.show-menu-arrow.open > .dropdown-toggle {
        z-index: 1061;
    }

    .bootstrap-select.show-menu-arrow .dropdown-toggle:before {
        content: '';
        border-left: 7px solid transparent;
        border-right: 7px solid transparent;
        border-bottom: 7px solid rgba(204, 204, 204, 0.2);
        position: absolute;
        bottom: -4px;
        left: 9px;
        display: none;
    }

    .bootstrap-select.show-menu-arrow .dropdown-toggle:after {
        content: '';
        border-left: 6px solid transparent;
        border-right: 6px solid transparent;
        border-bottom: 6px solid white;
        position: absolute;
        bottom: -4px;
        left: 10px;
        display: none;
    }

    .bootstrap-select.show-menu-arrow.dropup .dropdown-toggle:before {
        bottom: auto;
        top: -3px;
        border-top: 7px solid rgba(204, 204, 204, 0.2);
        border-bottom: 0;
    }

    .bootstrap-select.show-menu-arrow.dropup .dropdown-toggle:after {
        bottom: auto;
        top: -3px;
        border-top: 6px solid white;
        border-bottom: 0;
    }

    .bootstrap-select.show-menu-arrow.pull-right .dropdown-toggle:before {
        right: 12px;
        left: auto;
    }

    .bootstrap-select.show-menu-arrow.pull-right .dropdown-toggle:after {
        right: 13px;
        left: auto;
    }

    .bootstrap-select.show-menu-arrow.open > .dropdown-toggle:before, .bootstrap-select.show-menu-arrow.open > .dropdown-toggle:after {
        display: block;
    }

    .bs-searchbox, .bs-actionsbox, .bs-donebutton {
        padding: 4px 8px;
    }

    .bs-actionsbox {
        width: 100%;
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        box-sizing: border-box;
    }

        .bs-actionsbox .btn-group button {
            width: 50%;
        }

    .bs-donebutton {
        float: left;
        width: 100%;
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        box-sizing: border-box;
    }

        .bs-donebutton .btn-group button {
            width: 100%;
        }

    .bs-searchbox + .bs-actionsbox {
        padding: 0 8px 4px;
    }

    .bs-searchbox .form-control {
        margin-bottom: 0;
        width: 100%;
        float: none;
    }

    .select-with-transition {
        border: 0 !important;
        background-image: linear-gradient(#9c27b0, #9c27b0), linear-gradient(#D2D2D2, #D2D2D2);
        background-size: 0 2px, 100% 1px;
        background-repeat: no-repeat;
        background-position: center bottom, center calc(100% - 1px);
        background-color: rgba(0, 0, 0, 0) !important;
        transition: background 0s ease-out !important;
        float: none !important;
        box-shadow: none !important;
        border-radius: 0 !important;
        color: #3C4858 !important;
        height: 34px;
        padding-left: 0 !important;
        padding-bottom: 5px !important;
    }

        .select-with-transition .caret, .select-with-transition .ripple-container {
            display: none;
        }

    .btn-group.bootstrap-select.show-tick.open .select-with-transition {
        outline: none !important;
        background-image: linear-gradient(#9c27b0, #9c27b0), linear-gradient(#D2D2D2, #D2D2D2) !important;
        background-size: 100% 2px, 100% 1px !important;
        box-shadow: none;
        transition-duration: 0.3s !important;
    }
</style>
<div class="card">
    <div class="card-body">
        <h2 class="card-title" id="EmployeeName">
            @Model.Employee.Name
        </h2>
        @if (User.IsInRole("Calendar"))
        {

            <div class="row">
                <div class="col-md-6">


                    @if (Model.Employee.Type != "Percentage")
                    {
                        <div class="col-md-12">
                            <h1>
                                @Model.Amount
                            </h1>
                        </div>
                    }
                </div>
                <div class="col-md-6">
                    <h2 class="card-title">
                        Amount
                    </h2>

                    <div class="col-md-12">
                        <h1>
                            @Model.FinalAmount
                        </h1>
                    </div>
                </div>

            </div>


        }
        else
        {
            if (Model.Type == "Worked Hours")
            {


                <div style="margin:1rem;" class="row">
                    <h5 style="font-weight:500;">
                        Worked Hours
                    </h5>
                    <p>
                        The system looks at the worked hours of the employee Selected for the period of time.
                        The filters has been pre-selected, you can adjust it to suit your needs. Breaks / Absence are not Included
                    </p>
                </div>
            }
            else if (Model.Type == "Percentage")
            {
                <div style="margin:1rem;" class="row">
                    <h5 style="font-weight:500;">
                        Percentage
                    </h5>
                    <p>
                        The System looks at the “total price” of all appointment the employee has made within the selected period of time and multiplies
                        if by the percentage you have set for the employee. Breaks / Absence are not Included

                    </p>
                </div>
            }
            else if (Model.Type == "Time to Time")
            {
                <div style="margin:1rem;" class="row">
                    <h5 style="font-weight:500;">
                        Time to Time

                    </h5>
                    <p>
                        The system calculates how much time the employee spends in the salon. Breaks / Absence are not Included
                    </p>
                </div>
            }
            <div class="row">
                <div class="form-group col-md-3">
                    <div class="input-group input-group-dynamic">
                        <input type="date" style="margin-top:8px;" value="@Model.StartDate.ToString("yyyy-MM-dd")" id="StartDate" name="StartDate" class="form-control" />
                    </div>
                </div>
                <div class="form-group col-md-3">
                    <div class="input-group input-group-dynamic">

                        <input type="date" style="margin-top:8px;" value="@Model.EndDate.ToString("yyyy-MM-dd")" id="EndDate" name="EndDate" class="form-control" />
                    </div>
                </div>


                <div style="display:none;" class="form-group col-md-3">
                    <select style="margin-top:8px;" class="form-control choices__input" id="EmployeeID" name="EmployeeID" title="Choose Employee" data-size="7">
                        <option disabled>Choose Employee </option>
                        @foreach (var item in Model.Employees)
                        {
                            if (Model.EmployeeID == item.ID)
                            {
                                <option selected value="@item.ID">@item.Name </option>

                            }
                            else
                            {
                                <option value="@item.ID">@item.Name </option>
                            }
                        }
                    </select>
                </div>


                <div class="form-group col-md-3" id="SelectedStatusesGR" style="margin-top:13px;">

                    <select class="selectpicker" id="SelectedStatuses" name="SelectedStatuses" data-style="select-with-transition" multiple title="Choose Statuses" data-size="7">
                        <option disabled> Choose Status</option>
                        @if (Model.Statuses != null)
                        {
                            foreach (var item in Model.Statuses)
                            {
                                if (item == "Paid" || item == "Pending")
                                {
                                    <option selected value="@item">@item </option>

                                }
                                else
                                {
                                    <option value="@item">@item </option>
                                }
                            }
                        }
                    </select>
                </div>
                <div class="form-group col-md-3" style="margin-top:8px;">
                    <select class="choices__input" name="IsCancelled" id="IsCancelled">
                        <option selected value="False">False </option>
                        <option value="True">True </option>
                    </select>
                </div>
                @if (Model.Type == "Percentage" || Model.Type == "Worked Hours")
                {
                    <div style="display:none;" class="form-group col-md-3">
                        <input style="margin-top:8px;" placeholder="Enter Amount" type="number" value="@Model.Employee.Percentage" id="Percentage" class="form-control" />
                    </div>
                }
            </div>
            <button class="btn btn-primary" type="button" id="ViewData">VIEW PAYROLL</button>

            <div class="card" id="PayRollCard">
                <div class="card-body">
                    <h2 class="card-title" id="EmployeeName">
                    </h2>
                    <div class="row">
                        <div class="col-md-6">


                            <div class="col-md-12">

                                <h1 id="Amount">
                                </h1>
                            </div>
                        </div>
                        <div id="SecondAmountBOX" class="col-md-6">
                            <h2 class="card-title" style="display:none;">
                                Amount
                            </h2>

                            <div class="col-md-12">
                                <h1 id="FinalAmount">
                                </h1>
                            </div>
                        </div>

                    </div>


                </div>
            </div>
        }

    </div>
</div>


<script>

    $('#SelectedStatusesGR').on('click', function (event) {
        const target = $(event.target); // Get the clicked element

        // Check if the clicked element is the dropdown button
        if (target.is('.btn[data-id="SelectedStatuses"]') || target.parents('.btn[data-id="SelectedStatuses"]').length) {
            // Toggle the dropdown menu visibility
            target.closest('.btn-group').find('.dropdown-menu').toggleClass('dropdown-menu-show');
        } else {
            // If clicked outside, hide the dropdown menu
            $('.dropdown-menu-show').removeClass('dropdown-menu-show');
        }

        event.stopPropagation(); // Stop the click event from propagating to avoid unintended behaviors
    });

    $(document).ready(function () {
        $("#ViewData").click(function () {
            var StartDate = $("#StartDate").val();
            var EndDate = $("#EndDate").val();
            var Status = $("#SelectedStatuses").val();
            var employeeID = $("#EmployeeID").val();
            var IsCancelled = $("#IsCancelled").val();
            var Percentage = $("#Percentage").val();
            var requestData = JSON.stringify({
                StartDate: StartDate,
                EndDate: EndDate,
                EmployeeID: employeeID,
                Status: Status,
                IsCancelled: IsCancelled,
                Percentage: Percentage
            });
            $.ajax({
                url: '@Url.Action("GetPayRollData", "PayRoll")',
                type: "get",
                data: { requestData: requestData }, // Send serialized data
            })
                .done(function (response) {
                    if (response.success) {
                        var baseUrl = '@Url.Action("ViewPayRoll", "PayRoll")';
                        var employeeName = encodeURIComponent(response.Employee.Name);
                        var employeeSpecialization = encodeURIComponent(response.Employee.Specialization);
                        var amount = encodeURIComponent(response.Amount);
                        var finalAmount = encodeURIComponent(response.FinalAmount);
                        var percentage = encodeURIComponent(response.Percentage);
                        var companyName = encodeURIComponent(response.Company.Business);
                        var companyPhoneNumber = encodeURIComponent(response.Company.PhoneNumber);
                        var companyAddress = encodeURIComponent(response.Company.Address);
                        var companyLogo = encodeURIComponent(response.Company.Logo);
                        var startDate = encodeURIComponent(response.StartDate);
                        var endDate = encodeURIComponent(response.EndDate);
                        var type = encodeURIComponent(response.Employee.Type);
                        var tips = encodeURIComponent(response.Tips);
                        var newTabUrl = `${baseUrl}?employeeName=${employeeName}&employeeSpecialization=${employeeSpecialization}&amount=${amount}&finalAmount=${finalAmount}&percentage=${percentage}&companyName=${companyName}&companyPhoneNumber=${companyPhoneNumber}&companyAddress=${companyAddress}&companyLogo=${companyLogo}&StartDate=${startDate}&EndDate=${endDate}&Type=${type}&Tips=${tips}&ID=${response.ID}`;
                        window.open(newTabUrl, '_blank');
                    } else {
                        $(".errorDiv").html(response.Message);
                    }

                });
        });
    });
</script>